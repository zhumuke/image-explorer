(()=>{"use strict";var e={112:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{c(r.next(e))}catch(e){n(e)}}function a(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const i=o(549),n=o(622),s=o(747),a=o(622);let c="";function l(e){return r(this,void 0,void 0,(function*(){const t=[];try{for(const[o,r]of yield i.workspace.fs.readDirectory(e))if(r===i.FileType.File){const r=a.posix.join(e.path,o);t.push(i.Uri.parse(r).with({scheme:"vscode-resource"}).toString())}}catch(e){return[]}return t}))}function p(e,t,o,r){return`${Object.keys(e).map((i=>`<div class="${i.split(t)[1]===c?"dir focus-dir":"dir"}">\n        <span class='dir-img'></span>\n        ${i.split(t)[1]}\n      </div>\n      <div class="img-list">\n      ${e[i].map((e=>{const i=e.split(t)[1];return`<div class="img-item">\n            <div class="img-wrapper" style='background-image: url("${e}")'></div>\n            <button class='btn' data-clipboard-text="${null==o?void 0:o.replace("$pathOfImage",i)}">css</button>\n            <button class='btn' data-clipboard-text="${null==r?void 0:r.replace("$pathOfImage",i)}">jsx</button>\n          </div>`}))}\n      </div>`))}`}function u(e){return Object.values(e).reduce(((e,t)=>e+t.length),0)+""}t.activate=function(e){console.log('"imageExplorer" 激活');const t=i.workspace.getConfiguration("imageExplorer").directoryName||[],o=i.workspace.getConfiguration("imageExplorer").template.cssUrl||"",d=i.workspace.getConfiguration("imageExplorer").template.jsxImport||"",g=i.workspace.getConfiguration("imageExplorer").rootDirectory||"src",m=i.workspace.getConfiguration("imageExplorer").allPath||[],f=i.workspace.workspaceFolders?i.workspace.workspaceFolders[0].name:"",h=i.workspace.workspaceFolders?i.workspace.workspaceFolders[0].uri:null;i.commands.executeCommand("setContext","ext.imageExplorer.supportedFolders",m.map((e=>{const t=e.split("/");return t[t.length-1]})));let v=i.commands.registerCommand("imageExplorer.showImageExplorer",(v=>r(this,void 0,void 0,(function*(){if(!h)return void i.window.showInformationMessage("no workspace, choose one!");let w={};if(m)for(let e=0;e<m.length;e++){const t=m[e],o=yield l(i.Uri.parse(t));o.length>0&&(w=Object.assign(Object.assign({},w),{[t]:o}))}if(v){const e=v.path.split(f)[1];if(c=e,m&&-1===m.indexOf(e)){const t=yield l(v);w=Object.assign(Object.assign({},w),{[e]:t}),i.workspace.getConfiguration().update("imageExplorer.allPath",[e,...m])}}const x=i.window.createWebviewPanel("feResourceWebView","静态资源视图",i.ViewColumn.One,{enableScripts:!0,retainContextWhenHidden:!0}),b=p(w,f,o,d),j=function(e,t){const o=n.join(e.extensionPath,"./index.html"),r=n.dirname(o);let a=s.readFileSync(o,"utf-8");return a=a.replace(/(<link.+?href="|<script.+?src="|<img.+?src="|url\(")(.+?)"/g,((e,t,o)=>t+i.Uri.file(n.resolve(r,o)).with({scheme:"vscode-resource"}).toString()+'"')),a}(e);x.webview.html=j.replace("${images}",b).replace("${total}",u(w)),x.webview.onDidReceiveMessage((e=>r(this,void 0,void 0,(function*(){if("scanProjectImages"===e.command){const e=i.workspace.getConfiguration().get("imageExplorer.allPath")||[];let n={},s=[];if(e)for(let t=0;t<e.length;t++){const o=e[t],r=yield l(i.Uri.parse(o));r.length>0&&(s.push(o),n=Object.assign(Object.assign({},n),{[o]:r}))}const c=i.Uri.joinPath(h,g),m=yield function(e,t=["images"]){return r(this,void 0,void 0,(function*(){const o=[e];let r={};for(;o.length>0;){const e=o.pop(),n=[];if(e){for(const[r,s]of yield i.workspace.fs.readDirectory(e)){const c=i.Uri.parse(a.posix.join(e.path,r));s===i.FileType.File?[".jpg",".png",".jpeg"].some((e=>r.endsWith(e)))&&n.push(c.with({scheme:"vscode-resource"}).toString()):s===i.FileType.Directory&&(t.indexOf(r),o.push(c))}n.length>0&&(r=Object.assign(Object.assign({},r),{[e.path]:n}))}}return r}))}(c,t);Object.keys(m).forEach((e=>{-1===s.indexOf(e)&&s.push(e)})),i.workspace.getConfiguration().update("imageExplorer.allPath",s),i.commands.executeCommand("setContext","ext.imageExplorer.supportedFolders",s.map((e=>{const t=e.split("/");return t[t.length-1]}))),n=Object.assign(Object.assign({},n),m);const v=p(n,f,o,d);x.webview.html=j.replace("${images}",v).replace("${total}",u(n))}}))),void 0,e.subscriptions)}))));e.subscriptions.push(v)},t.deactivate=function(){}},747:e=>{e.exports=require("fs")},622:e=>{e.exports=require("path")},549:e=>{e.exports=require("vscode")}},t={},o=function o(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,o),n.exports}(112);module.exports=o})();